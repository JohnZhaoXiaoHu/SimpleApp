# 系统模块总体方案



基本思想：一切业务皆服务



用户（user）、角色（role）、数据权限（permission）、菜单（menu）

组织机构（org、organization）、岗位（post、position）

字典表（dict、dictionary）、日志（log）



【ok】认证 Cookies

【ok】认证 Jwt

【0.5】权限（鉴权）（分布式）

【ok】AutoMapper

【ok】缓存 redis、memory cache

【0.5】EF Core Code First

动态挂载/卸载程序集

【0.5】NLog 日志

定时任务 Quartz

【ok】自动注入Service

【ok】AutoMapper

【ok】数据验证（基于data annotation）



Autofac【不用】



## 概述

简单三层，力求精简

集中编码，简化流程



功能类皆为 Helper，如：JsonHelper、MapperHelper



## 如何开始





## 如何进行开发

1 创建实体

（1）创建实体

（2）配置实体

2 编写业务服务

（1）编写业务服务

（2）创建数据模型

3 配置路由





## 如何部署



## 基本能力

### 1 自动注册实体

所有实体继承抽象类 `EntityBase` 将会自动注册实体，并可以通过重写 `ConfigureEntity` 方法配置实体。

如：

```csharp
/// <summary>
/// 用户角色关联表
/// </summary>
public class SysUserRole : EntityBase
{
    /// <summary>
    /// 用户Id
    /// </summary>
    public Guid UserId { get; set; }

    /// <summary>
    /// 角色Id
    /// </summary>
    public Guid RoleId { get; set; }

    /// <summary>
    /// 用户
    /// </summary>
    public SysUser? User { get; set; }

    /// <summary>
    /// 角色
    /// </summary>
    public SysRole? Role { get; set; }

    public override void ConfigureEntity(ModelBuilder builder)
    {
        // 复合主键设置
        builder.Entity<SysUserRole>()
            .HasKey(e => new { e.UserId, e.RoleId });

        // 关系配置
        builder.Entity<SysUserRole>()
            .HasOne(ur => ur.User)
            .WithMany(u => u.UserRoles)
            .IsRequired(false);
        builder.Entity<SysUserRole>()
            .HasOne(ur => ur.Role)
            .WithMany(r => r.UserRoles)
            .IsRequired(false);
    }
}
```

### 2 实体注释不需要 `[Comment]`

Code First 方式下，如果要给表或字段添加注释，需要使用 `[Comment]` 标签或 Fulent API 的 `HasComment` 方法，具体参考：[EF Core 文档：创建模型：表注释](https://docs.microsoft.com/zh-cn/ef/core/modeling/entity-types?tabs=data-annotations#table-comments)。

在 `SimpleApp` 下，只要实体的类名或属性存在 summary 注释，将会自动将 summary 的内容写入注释，不需要额外使用 `[Comment]` 配置。**不需要任何配置。**

注：该功能是基于 XML 的注释文档实现的。

### 3 自动注册服务层服务

所有以 `Service` 结尾的服务，都会自动注册。

需要在 `Program.cs` 中配置：

```csharp
builder.Services.AddAutoServices("Simple.Services");
```

其中，参数 `"Simple.Services"` 是服务层程序集名称。

